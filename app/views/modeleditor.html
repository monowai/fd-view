<!--
  ~
  ~  Copyright (c) 2012-2016 "FlockData LLC"
  ~
  ~  This file is part of FlockData.
  ~
  ~  FlockData is free software: you can redistribute it and/or modify
  ~  it under the terms of the GNU General Public License as published by
  ~  the Free Software Foundation, either version 3 of the License, or
  ~  (at your option) any later version.
  ~
  ~  FlockData is distributed in the hope that it will be useful,
  ~  but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~  GNU General Public License for more details.
  ~
  ~  You should have received a copy of the GNU General Public License
  ~  along with FlockData.  If not, see <http://www.gnu.org/licenses/>.
  -->


<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Model
    <small>Content that describe the data you want to import</small>
  </h1>
  <ol class="breadcrumb">
    <li><a ui-sref="welcome"><i class="fa fa-home"></i> Home</a></li>
    <li class="active">Model</li>
  </ol>
</section>

<!-- Main content -->
<section class="content">
  <div class="row">
    <div class="col-md-12">
      <div class="nav-tabs-custom">
        <ul class="nav nav-tabs pull-right">
          <li uib-dropdown class="active">
            <a href id="view-menu" uib-dropdown-toggle>
              View <span class="caret"></span></a>
            <ul class="dropdown-menu pull-right" uib-dropdown-menu role="menu" aria-labelledby="view-menu">
              <li role="menuitem" class="active"><a href data-target="#structure" data-toggle="tab" ng-click="updateModel()">Structure</a></li>
              <li role="menuitem"><a href data-target="#json" data-toggle="tab" ng-click="checkModel()">Edit JSON</a></li>
              <li role="menuitem"><a href data-target="#sample" data-toggle="tab">Data Sample</a></li>
            </ul>
          </li>
          <li uib-dropdown>
            <a href id="action-menu" uib-dropdown-toggle>
            Action <span class="caret"></span></a>
            <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="action-menu">
              <li role="menuitem"><a href ng-click="save()">Save</a></li>
              <li role="menuitem"><a href ng-click="validate()">Validate</a></li>
              <li class="divider"></li>
              <li role="menuitem"><a href ng-click="cancel()">Cancel</a></li>
            </ul>
          </li>

          <li class="pull-left header"><i class="fa fa-share-alt"></i> Edit Content Model - {{contentModel.documentType.name}}</li>
        </ul>
        <div class="tab-content">
          <div id="structure" class="tab-pane fade active in">
            <div class="col-md-2 col-xs-6">
              <div class="form-group" >
                <label class="control-label">Layout</label>
                <div class="pull-right">
                  <select ng-model="layout" ng-options="l.name for l in layouts"></select>
                </div>
              </div>

              <label class="control-label">Create</label>

              <button id="coldef" class="btn btn-sm btn-block btn-default" ng-click="createColumn()">Calculated Column</button>
              <button id="tag" class="btn btn-sm btn-block btn-warning" draggable options="{opacity: .5,revert: true}" ng-click="createNew($event)">Tag</button>
              <!--<button id="alias" class="btn btn-sm btn-block btn-info" draggable options="{opacity: .5,revert: true}">Alias</button>-->
              <button id="entity" class="btn btn-sm btn-block btn-primary" draggable droppable="buttonDrop" options="{opacity: .5,revert: true}" ng-click="createEntitylink()">Entity Link</button>

              <label uib-dropdown>
                <a href id="list-menu" uib-dropdown-toggle>
                  {{list}} <span class="caret"></span></a>
                <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="list-menu">
                  <li role="menuitem"><a href ng-click="list='Columns'">Columns</a></li>
                  <li role="menuitem"><a href ng-click="list='Tags'">Tags</a></li>
                  <li role="menuitem"><a href ng-click="list='Settings'">General Settings</a></li>
                </ul>
              </label>
              <!--<label class="control-label">Columns</label>-->
              <div ng-height="400" class="scroll-col" ng-show="list==='Columns'">
                <div class="btn-toolbar" id="Columns">
                  <button id="{{col}}" class="btn btn-xs" ng-class="{'btn-warning' : val.tag, 'btn-primary': !val.tag, 'btn-dim': !val.persistent}" draggable options="{opacity: .5,revert: true}" style="margin: 2px;" ng-repeat="(col, val) in contentModel.content" ng-click="showColDef(col)">{{col}}</button>
                </div>
              </div>
              <div ng-height="400" class="scroll-col" ng-show="list==='Tags'">
                <div class="btn-toolbar" id="Tags">
                  <button id="{{tag.id}}" class="btn btn-xs btn-warning" draggable options="{opacity: .5,revert: true}" style="margin: 2px;" ng-repeat="tag in tags" ng-click="showColDef(tag.id,true)">{{tag.label}}</button>
                </div>
              </div>
              <div ng-height="400" class="scroll-col-np" ng-show="list==='Settings'">
                <div class="form-group">
                  <label class="control-label">Fortress:</label>
                  <input type="text" class="form-control input-sm" ng-model="contentModel.fortress.name" placeholder="Description">
                </div>
                <div class="form-group">
                  <label class="control-label">Document Type:</label>
                  <input type="text" class="form-control input-sm" ng-model="contentModel.documentType.name" placeholder="Description">
                </div>
                <div class="form-group">
                  <label class="control-label">Description:</label>
                  <input type="text" class="form-control input-sm" ng-model="contentModel.name" placeholder="Description">
                </div>
                <div class="form-group">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="emptyIgnored" name="emptyIgnored" ng-model="contentModel.emptyIgnored"> Ignore empty
                    </label>
                  </div>
                </div>
                <div class="form-group">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="archiveTags" name="archiveTags" ng-model="contentModel.archiveTags"> Archive tags
                    </label>
                  </div>
                </div>
                <div class="form-group">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="entityOnly" name="entityOnly" ng-model="contentModel.entityOnly"> Entity only
                    </label>
                  </div>
                </div>
                <div class="form-group">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="trackSuppressed" name="trackSuppressed" ng-model="contentModel.trackSuppressed"> Track suppressed
                    </label>
                  </div>
                </div>
                <div class="form-group">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="searchSuppressed" name="searchSuppressed" ng-model="contentModel.searchSuppressed"> Search suppressed
                    </label>
                  </div>
                </div>
                <div class="form-group">
                  <label class="control-label">Pre-parse Expression:</label>
                  <input type="text" class="form-control input-sm" ng-model="contentModel.preParseRowExp" placeholder="Pre-parse row expression">
                </div>
                <div class="form-group">
                  <label class="control-label">Segment Expression:</label>
                  <input type="text" class="form-control input-sm" ng-model="contentModel.segmentExpression" placeholder="Segment expression">
                </div>
              </div>
            </div>
            <div class="col-md-10" droppable="handleDrop">
              <cytoscape elements="modelGraph" layout="layout" styles="styles" selected-nodes="nodes" ng-height="180"></cytoscape>
            </div>
          </div>

          <!-- Edit JSON -->
          <div id="json" class="tab-pane fade">
            <div ng-jsoneditor="onEditorLoad" ng-model="contentModel" options="editorOptions" ng-height="180"></div>
          </div>

          <!-- View Data Sample -->
          <div id="sample" class="tab-pane fade">
            <div ng-show="!dataSample">
              <div class="row">
                <div class="col-sm-3">
                  <fieldset>
                    <legend>Upload <button type="submit" class="btn btn-primary pull-right" ng-click="getDefault()" ng-disabled="!csvContent" ng-show="!!csvContent"><i class="fa fa-bolt"></i>&nbsp; Create Default</button></legend>
                    <div class="row">

                      <div class="form-group">
                        <label for="data-delim" class="col-xs-4 control-label">Delimiter</label>
                        <div class="col-xs-7">
                          <input type="text" class="form-control" id="data-delim" ng-model="delim">
                        </div>
                      </div>

                      <div class="col-sm-6">
                        <div class="form-group">
                          <div class="checkbox">
                            <label>
                              <input type="checkbox" ng-model="ignoreEmpty"> <b>Ignore empty Cols</b>
                            </label>
                          </div>
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="form-group">
                          <div class="checkbox">
                            <label>
                              <input type="checkbox" ng-model="hasHeader"> <b>Has Header</b>
                            </label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </fieldset>
                </div>
                <div class="col-sm-9">
                  <div class="well well-sm">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="file-box" file-box="loadFile($fileContent, $fileName)"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="hscroll-table fader" ng-show="!!dataSample">
              <table id="datasample" class="table table-bordered table-hover">
                <thead>
                  <tr>
                    <th class="col coldef" ng-repeat="key in keys" ng-click="showColDef(key.name)" ng-class="{'tag': key.type==='tag'}"><span>{{key.name}}</span></th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="d in dataSample">
                    <td ng-repeat="(k,v) in d">{{v}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p ng-show="dataSample.length>49"><i>* Only first 50 rows are displayed</i></p>
          </div>

        </div>
        <div class="clearfix"></div>
        <br>
      </div>
    </div>
  </div>
</section>

<script type="text/ng-template" id="edit-element.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="cancel()">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Edit Properties</h4>
  </div>
  <form name="coldefProperties" role="form" class="form-horizontal" ng-submit="ok(coldefProperties.$valid)" novalidate>
    <div class="modal-body">
      <uib-tabset class="nav-tabs-custom">
        <uib-tab heading="Main">
          <div class="form-group">
            <div class="col-sm-offset-3 col-sm-3">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="isTag" name="isTag" ng-model="elem.tag" ng-disabled="target"> <b>Tag</b>
                </label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="name" class="col-sm-3 control-label">Name: </label>
            <div class="col-sm-8">
              <textarea id="name" name="name" class="form-control" ng-model="elem.name" rows="1" autofocus></textarea>
            </div>
          </div>
          <div class="form-group">
            <label for="code" class="col-sm-3 control-label">Code: </label>
            <div class="col-sm-8">
              <textarea id="code" name="code" class="form-control" ng-model="elem.code" rows="1" required></textarea>
            </div>
          </div>
          <div class="form-group">
            <label for="label" class="col-sm-3 control-label">Label: </label>
            <div class="col-sm-8">
              <textarea id="label" name="label" class="form-control" ng-model="elem.label" rows="1" required></textarea>
            </div>
          </div>
          <div class="form-group">
            <label for="relationship" class="col-sm-3 control-label">Relationship: </label>
            <div class="col-sm-8">
              <textarea id="relationship" name="relationship" class="form-control" ng-model="elem.relationship" rows="1"></textarea>
            </div>
          </div>
          <div class="form-group">
            <label for="keyPrefix" class="col-sm-3 control-label">Key Prefix: </label>
            <div class="col-sm-8">
              <input type="text" id="keyPrefix" name="keyPrefix" class="form-control" ng-model="elem.keyPrefix">
            </div>
          </div>
          <div class="form-group">
            <label for="notFoundCode" class="col-sm-3 control-label">Not Found Code: </label>
            <div class="col-sm-8">
              <input type="text" id="notFoundCode" name="notFoundCode" class="form-control" ng-model="elem.notFoundCode">
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-offset-3 col-sm-3">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="mustExist" name="mustExist" ng-model="elem.mustExist"> Must Exist
                </label>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="merge" name="merge" ng-model="elem.merge"> Merge
                </label>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="checkbox">
                <label>
                  <input type="checkbox" id="reverse" name="reverse" ng-model="elem.reverse"> Reverse
                </label>
              </div>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Properties">
          <label>Properties: </label>
          <div class="form-group" ng-repeat="prop in elem.properties">
            <div class="col-sm-6 prop-col">
              <select id="prop.source" class="form-control" ng-model="prop.source" ng-options="c.name as c.name for c in coldefs">
                <option value='' disabled selected>Source</option>
              </select>
            </div>
            <div class="col-sm-6 prop-col">
              <div class="input-group">
                <input type="text" class="form-control" id="prop.target" name="prop.target" ng-model="prop.target" placeholder="Target">
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" ng-click="elem.properties.splice($index,1)" ng-show="!$last"><i class="fa fa-trash"></i></button>
                </span>
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" ng-click="elem.properties.push({})" ng-show="$last"><i class="fa fa-plus"></i></button>
                </span>
              </div>
            </div>
          </div>
          <br>
          <label>Relationships Properties: </label>
          <div class="form-group" ng-repeat="rprop in elem.rlxProperties">
            <div class="col-sm-6 prop-col">
              <select id="rprop.source" class="form-control" ng-model="rprop.source" ng-options="c.name as c.name for c in coldefs">
                <option value='' disabled selected>Source</option>
              </select>
            </div>
            <div class="col-sm-6 prop-col">
              <div class="input-group">
                <input type="text" class="form-control" id="rprop.target" name="rprop.target" ng-model="rprop.target" placeholder="Target">
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" ng-click="elem.rlxProperties.splice($index,1)" ng-show="!$last"><i class="fa fa-trash"></i></button>
                </span>
                <span class="input-group-btn">
                  <button type="button" class="btn btn-primary btn-flat" ng-click="elem.rlxProperties.push({})" ng-show="$last"><i class="fa fa-plus"></i></button>
                </span>
              </div>
            </div>
          </div>
        </uib-tab>
      </uib-tabset>
      <!--<div class="center"><label>{{active}}</label></div>-->
      <div class="form-group">
        <label for="active" class="col-sm-3 control-label">Connected to: </label>
        <div class="col-sm-8">
          <select id="active" name="active" class="form-control" ng-options="c.label as c.label for c in canConnect" ng-model="active"></select>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default pull-left" ng-click="cancel('cancel')">Cancel</button>
      <button type="submit" class="btn btn-primary" ng-disabled="coldefProperties.$invalid"><i class="fa fa-bolt"></i>&nbsp; Ok</button>
    </div>
  </form>
</script>

<script type="text/ng-template" id="edit-coldef.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="cancel()">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">{{caption}} - {{name}}</h4>
  </div>
  <form name="colDefForm" class="form-horizontal" novalidate>
    <div class="modal-body">
      <uib-tabset class="nav-tabs-custom" active="tab">
        <uib-tab heading="Main" ng-hide="cd.openAsTag">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="target" class="col-sm-3 control-label">Store as: </label>
                <div class="col-sm-9">
                  <input type="text" id="target" name="target" class="form-control" ng-model="cd.target" placeholder="Defaults to source column name..." autofocus>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="dataType" class="col-sm-3 control-label">Data Type: </label>
                <div class="col-sm-9">
                  <select id="dataType" class="form-control" ng-model="cd.dataType" ng-options="dt as dt for dt in dataTypes">
                  </select>
                </div>
              </div>
            </div>
          </div>
          <div class="row" ng-show="cd.dataType==='date'">
            <div class="col-md-6" >
              <div class="form-group">
                <label for="dateFormat" class="col-sm-3 control-label">Date Format: </label>
                <div class="col-sm-9">
                  <select id="dateFormat" class="form-control" ng-model="cd.dateFormat" ng-options="df as df for df in dateFormats" ng-required="cd.dataType==='date'">
                  </select>
                </div>
              </div>
            </div>
            <div class="col-md-6" ng-show="cd.dateFormat==='custom'">
              <div class="form-group">
                <label for="customDate" class="col-sm-3 control-label">Custom Date: </label>
                <div class="col-sm-9">
                  <input type="text" id="customDate" name="customDate" class="form-control" ng-model="cd.customDate" ng-required="cd.dateFormat==='custom'" placeholder="Select your date format like 'yyyy-MM-dd' ">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <div class="col-sm-offset-1 col-xs-3">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="isPK" name="isPK" ng-model="cd.callerRef"> <b>Primary Key</b>
                    </label>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="isTitle" name="isTitle" ng-model="cd.title"> <b>Title</b>
                    </label>
                  </div>
                </div>
                <div class="col-xs-3">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="isDescr" name="isDescr" ng-model="cd.description"> <b>Description</b>
                    </label>
                  </div>
                </div>
                <div class="col-xs-2">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="isTag" name="isTag" ng-model="cd.tag"> <b>Tag</b>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label for="value" class="col-sm-1 control-label">Value: </label>
                <div class="col-sm-11">
                  <!--<textarea id="value" name="value" class="form-control code" ng-model="cd.value" rows="1" ng-disabled="cd.tag" ng-trim="false" msd-elastic smart-area="codeConf" placeholder="Default is value in the column. You can use a SPeL expression, e.g. #data['colA']+'-'+#data['colB']"></textarea>-->
                  <textcomplete id="value" name="value" message="cd.value" columns="colNames" disabled="cd.tag" placeholder="Default is value in the column. You can use a SPeL expression, e.g. #data['colA']+'-'+#data['colB']"></textcomplete>
                </div>
              </div>
            </div>
          </div>
          <div class="row" ng-show="cd.dataType==='date'">
            <div class="col-xs-offset-1 col-md-5">
              <div class="form-group">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="createDate" name="createDate" ng-model="cd.createDate"> <b>Create date</b>
                  </label>
                </div>
              </div>
            </div>
            <div class="col-xs-offset-1 col-md-5">
              <div class="form-group">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="lastupDate" name="lastupDate" ng-model="cd.lastupDate"> <b>Last update date</b>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="row" ng-show="cd.dataType==='string'">
            <div class="col-xs-offset-1 col-md-5">
              <div class="form-group">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="createUser" name="createUser" ng-model="cd.createUser"> <b>Create user</b>
                  </label>
                </div>
              </div>
            </div>
            <div class="col-xs-offset-1 col-md-5">
              <div class="form-group" ng-show="cd.dataType==='string'">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="updateUser" name="updateUser" ng-model="cd.updateUser"> <b>Update user</b>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-offset-1 col-md-5">
              <div class="form-group">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="ignore" name="ignore" ng-model="cd.persistent"> <b>Capture this column</b>
                  </label>
                </div>
              </div>
            </div>
          </div>
          <fieldset ng-show="!cd.tag">
            <legend>Properties to set into Column &nbsp;<button type="button" class="btn btn-sm btn-primary" uib-tooltip="Add new" ng-click="editProperty()"><i class="fa fa-plus"></i></button></legend>

            <div class="row" ng-repeat="p in props">
              <div class="col-md-12">
                <div class="col-md-1 form-group">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="rlx" name="rlx" ng-model="p.$$rlx"  ng-true-value="'rlxProperties'" ng-false-value="'properties'"> <b>rlx</b>
                    </label>
                  </div>
                </div>
                <div class="col-md-5 form-group">
                  <label for="pSource" class="control-label col-xs-4">Source</label>
                  <div class="input-group col-xs-8">
                    <select id="pSource" name="pSource" class="form-control" ng-model="p.source" ng-options="c.name as c.name for c in columns">
                      <option value="" disabled selected>{{name}}</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6">
                  <label for="pTarget" class="control-label col-xs-3">Set as</label>
                  <div class="input-group col-xs-9">
                    <input id="pTarget" name="pTarget" type="text" class="form-control" ng-model="p.target"/>
                      <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-click="editProperty(p)" uib-tooltip="Edit"><i class="fa fa-edit"></i></button>
                      </span>
                      <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-click="props.splice($index,1)" uib-tooltip="Delete"><i class="fa fa-trash"></i></button>
                      </span>
                  </div>
                </div>
              </div>
            </div>
          </fieldset>
        </uib-tab>
        <uib-tab heading="Tag Properties" disable="!(cd.tag || cd.openAsTag)">
          <div class="row">
            <div class="col-md-8">
              <br>
              <div class="form-group">
                <label for="label" class="control-label col-xs-2">Tag Type</label>
                <div class="col-xs-10">
                  <input id="label" name="label" type="text" class="form-control" ng-model="cd.label"/>
                </div>
              </div>
              <div class="form-group">
                <label for="tagCode" class="control-label col-xs-2">Code</label>
                <div class="col-xs-10">
                  <!--<textarea id="tagCode" name="tagCode" rows="1" class="form-control" ng-model="cd.code" placeholder="Defaults to column data value" autofocus></textarea>-->
                  <textcomplete id="tagCode" name="tagCode" message="cd.code" columns="colNames" placeholder="Defaults to column data value"></textcomplete>
                </div>
              </div>
              <div class="form-group">
                <label for="nameCol" class="control-label col-xs-2">Name</label>
                <div class="col-xs-10">
                  <!--<textarea id="nameCol" name="nameCol" rows="1" class="form-control" ng-model="cd.name" placeholder="Optional columnName, #data['expression'], or 'literal value'"></textarea>-->
                  <textcomplete id="nameCol" name="nameCol" message="cd.name" columns="colNames" placeholder="Optional columnName, #data['expression'], or 'literal value'"></textcomplete>
                </div>
              </div>
              <div class="form-group">
                <label for="prefix" class="control-label col-xs-2">Prefix</label>
                <div class="col-xs-10">
                  <input id="prefix" name="prefix" type="text" class="form-control" ng-model="cd.keyPrefix" placeholder="Optional prefix to a code e.g. us.ma.cambridge vs. uk.ca.cambridge"/>
                </div>
              </div>
              <br>
              <div class="form-group">
                <div class="col-sm-offset-2 col-xs-5">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="mustExist" name="mustExist" ng-model="cd.mustExist"> <b>Must exist</b>
                    </label>
                  </div>
                </div>
                <div class="col-xs-5">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" id="merge" name="merge" ng-model="cd.merge" ng-checked="true"> <b>Merge if exists</b>
                    </label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="valIfNull" class="control-label col-xs-3">If null, set Code to</label>
                <div class="col-xs-9">
                  <input id="valIfNull" name="valIfNull" type="text" class="form-control" ng-model="cd.notFound"/>
                </div>
              </div>
              <div class="form-group">
                <label for="relationship" class="control-label col-xs-3">Relationship name</label>
                <div class="col-xs-9 col-sm-7">
                  <!--<input id="relationship" name="relationship" type="text" class="form-control" ng-model="cd.relationship"/>-->
                  <textcomplete id="relationship" name="relationship" message="cd.relationship" columns="colNames"></textcomplete>
                </div>
                <div class="col-sm-2 checkbox">
                  <label>
                    <input type="checkbox" name="reverse" ng-model="cd.reverse"> <b>Reverse</b>
                  </label>
                </div>
              </div>
              <div class="form-group">
                <label for="delim" class="control-label col-xs-3">Delimiter</label>
                <div class="col-xs-9 col-sm-7">
                  <input id="delim" name="delim" type="text" class="form-control" ng-model="cd.delimiter"/>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <fieldset>
                <legend>Geo Data</legend>
                <div class="form-group">
                  <label for="standard" class="control-label col-xs-3">Standard</label>
                  <div class="col-xs-9">
                    <input id="standard" name="standard" type="text" class="form-control" />
                  </div>
                </div>
                <div class="form-group">
                  <label for="geoX" class="control-label col-xs-3">X</label>
                  <div class="col-xs-9">
                    <input id="geoX" name="geoX" type="text" class="form-control" />
                  </div>
                </div>
                <div class="form-group">
                  <label for="geoY" class="control-label col-xs-3">Y</label>
                  <div class="col-xs-9">
                    <input id="geoY" name="geoY" type="text" class="form-control" />
                  </div>
                </div>
              </fieldset>
              <fieldset>
                <legend>Target Tags</legend>
                <div class="control-group">

                </div>
              </fieldset>
            </div>
            <div class="col-md-12">
              <fieldset>
                <legend>Properties to set into Tag &nbsp;<button type="button" class="btn btn-sm btn-primary" uib-tooltip="Add new" ng-click="editProperty()"><i class="fa fa-plus"></i></button></legend>

                <div class="row" ng-repeat="p in props">
                  <div class="col-md-12">
                    <div class="col-md-1 form-group">
                      <div class="checkbox">
                        <label>
                          <input type="checkbox" id="rlx" name="rlx" ng-model="p.$$rlx"  ng-true-value="'rlxProperties'" ng-false-value="'properties'"> <b>rlx</b>
                        </label>
                      </div>
                    </div>
                    <div class="col-md-5 form-group">
                      <label for="pSource" class="control-label col-xs-4">Source</label>
                      <div class="input-group col-xs-8">
                        <select id="pSource" name="pSource" class="form-control" ng-model="p.source" ng-options="c.name as c.name for c in columns">
                          <option value="" disabled selected>{{name}}</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <label for="pTarget" class="control-label col-xs-3">Set as</label>
                      <div class="input-group col-xs-9">
                        <input id="pTarget" name="pTarget" type="text" class="form-control" ng-model="p.target"/>
                      <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-click="editProperty(p)" uib-tooltip="Edit"><i class="fa fa-edit"></i></button>
                      </span>
                      <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-click="props.splice($index,1)" uib-tooltip="Delete"><i class="fa fa-trash"></i></button>
                      </span>
                      </div>
                    </div>
                  </div>
                </div>
              </fieldset>
            </div>
          </div>
        </uib-tab>
        <uib-tab heading="Entity Links">
          <div class="row">
            <div class="col-md-12">
              <fieldset>

                <legend class="legend">Existing Entity Links &nbsp;
                  <button type="button" class="btn btn-sm btn-primary" uib-tooltip="Add new" ng-click="addEntityLink()"><i class="fa fa-plus"></i></button>
                </legend>
                <table class="table" ng-show="cd.entityLinks.length>0">
                  <tr>
                    <th>Fortress</th>
                    <th>Document Name</th>
                    <th>Relationship</th>
                    <th class="checkbox">
                      <label>
                        <input type="checkbox" name="reverse" ng-model="cd.reverse"> <b>Reverse</b>
                      </label>
                    </th>
                  </tr>
                  <tr ng-repeat="e in cd.entityLinks">
                    <td class="col-xs-4"><input ng-model="e.fortress" ng-required="true" type="text" placeholder="Fortress name"></td>
                    <td class="col-xs-4"><input ng-model="e.documentName" ng-required="true" type="text" placeholder="Document name"></td>
                    <td class="col-xs-3"><input ng-model="e.relationshipName" ng-required="true" type="text" placeholder="Relationship name"></td>
                    <td>
                      <span class="input-group-btn">
                        <button type="button" class="btn btn-default btn-sm" ng-click="cd.entityLinks.splice($index,1)" uib-tooltip="Delete"><i class="fa fa-trash"></i></button>
                      </span>
                    </td>
                  </tr>
                </table>
              </fieldset>
            </div>
          </div>
        </uib-tab>
      </uib-tabset>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default pull-left" ng-click="cancel('cancel')">Cancel</button>
      <button type="submit" class="btn btn-primary" ng-click="ok(cd)" ng-disabled="colDefForm.$invalid"><i class="fa fa-bolt"></i>&nbsp; Ok</button>
    </div>
  </form>
</script>

<script type="text/ng-template" id="tag-property.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="cancel()">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Edit Property</h4>
  </div>
  <form ng-submit="ok(property)">
    <div class="modal-body">
      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <span class="checkbox">
              <label>
                <input type="checkbox" id="rlx" name="rlx" ng-model="property.$$rlx" ng-true-value="'rlxProperties'" ng-false-value="'properties'"> <b>Rlx</b>
              </label>
            </span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="source">Source</label>
            <select id="source" name="source" class="form-control" ng-model="property.source" ng-options="c.name as c.name for c in columns">
              <option value='' disabled selected>{{column}}</option>
            </select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="target">Set as</label>
            <input id="target" name="target" type="text" class="form-control" ng-model="property.target"/>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="pValue">Value: </label>
            <textarea id="pValue" class="form-control" ng-model="property.value"></textarea>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="pDataType" class="col-sm-3 control-label">Data Type: </label>
            <div class="col-sm-9">
              <select id="pDataType" class="form-control" ng-model="property.dataType" ng-options="dt as dt for dt in dataTypes">
              </select>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-group">
            <div class="checkbox">
              <label>
                <input type="checkbox" id="storeNull" name="storeNull" ng-model="property.storeNull"> <b>Store null</b>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="submit" class="btn btn-primary" ng-click="ok(property)"><i class="fa fa-bolt"></i>&nbsp; Ok</button>
      <button type="button" class="btn btn-default pull-left" ng-click="cancel()">Cancel</button>
    </div>
  </form>
</script>

<script type="text/ng-template" id="create-column.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="close()">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Create Column</h4>
  </div>
  <form name="column" class="form-horizontal" ng-submit="ok(obj)">
    <div class="modal-body">
      <div class="row">
        <div class="form-group">
          <label for="colname" class="col-sm-3 control-label">Name: </label>
          <div class="col-sm-8" ng-class="{'has-error': (!unique(obj.name) || column.colname.$invalid) && !column.colname.$pristine}">
            <input id="colname" name="colname" type="text" class="form-control" ng-model="obj.name" required autofocus
                   uib-tooltip="Name is not unique!" tooltip-enable="!unique(obj.name) && !column.colname.$pristine"/>
          </div>
        </div>
        <div class="form-group">
          <label for="coltype" class="col-sm-3 control-label">Data Type</label>
          <div class="col-sm-6">
            <select id="coltype" name="coltype" class="form-control" ng-model="obj.dataType" ng-options="t as t for t in ['string','number','date']"></select>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="submit" class="btn btn-primary"  ng-click="ok(obj)" ng-disabled="column.$invalid || !unique(obj.name)"><i class="fa fa-bolt"></i>&nbsp; Ok</button>
      <button type="button" class="btn btn-default pull-left" ng-click="close()">Cancel</button>
    </div>
  </form>
</script>

<script type="text/ng-template" id="create-entitylink.html">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="close()">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Create Entity Link</h4>
  </div>
  <form name="elink" class="form-horizontal" ng-submit="ok(obj)">
    <div class="modal-body">
      <div class="row">
        <div class="form-group">
          <label for="fortress" class="col-sm-3 control-label">Fortress: </label>
          <div class="col-sm-8" ng-class="{'has-error': elink.fortress.$invalid && !elink.fortress.$pristine}">
            <input id="fortress" name="fortress" type="text" class="form-control" ng-model="obj.fortress" required autofocus/>
          </div>
        </div>
        <div class="form-group">
          <label for="docname" class="col-sm-3 control-label">Document Name: </label>
          <div class="col-sm-8" ng-class="{'has-error': elink.docname.$invalid && !elink.docname.$pristine}">
            <input id="docname" name="docname" type="text" class="form-control" ng-model="obj.documentName" required />
          </div>
        </div>
        <div class="form-group">
          <label for="relname" class="col-sm-3 control-label">Relationship: </label>
          <div class="col-sm-8" ng-class="{'has-error': elink.relname.$invalid && !elink.relname.$pristine}">
            <input id="relname" name="relname" type="text" class="form-control" ng-model="obj.relationshipName" required />
          </div>
        </div>
        <div class="form-group">
          <label for="col" class="col-sm-3 control-label">Source Datacolumn</label>
          <div class="col-sm-6" ng-class="{'has-error': elink.col.$invalid && !elink.col.$pristine}">
            <select id="col" name="col" class="form-control" ng-model="obj.col" ng-options="s.name as s.name for s in colDefs" required></select>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="submit" class="btn btn-primary" ng-click="ok(obj)" ng-disabled="elink.$invalid"><i class="fa fa-bolt"></i>&nbsp; Ok</button>
      <button type="button" class="btn btn-default pull-left" ng-click="close()">Cancel</button>
    </div>
  </form>
</script>
